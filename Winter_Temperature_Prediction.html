<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>winter-temperature-prediction</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">



<section id="uk-winter-temperature-prediction" class="level1">
<h1>UK Winter Temperature prediction</h1>
<p>The aim of this project is to collect open data on climate indices and weather to predict whether the UK will have a colder than average winter this year. This is especially relevant for the winter of 2022/2023 with the war in Ukraine causing massive Gas and Oil problems for the UK and Europe as a whole.</p>
<p>So, the question we are asking is: <br> <br></p>
<section id="can-we-use-the-climate-indices-data-from-the-autumn-months-to-predictestimate-the-mean-upcoming-winter-temperature" class="level3">
<h3 class="anchored" data-anchor-id="can-we-use-the-climate-indices-data-from-the-autumn-months-to-predictestimate-the-mean-upcoming-winter-temperature">Can we use the Climate Indices data from the Autumn months to predict/estimate the mean upcoming winter temperature?</h3>
<p><br></p>
<p>Data Sources listed below:</p>
<p>AO - https://www.cpc.ncep.noaa.gov/products/precip/CWlink/daily_ao_index/monthly.ao.index.b50.current.ascii <br> The Arctic Oscillation (AO) measures the back-and-forth shifting of atmospheric pressure between the Arctic and the mid-latitudes of the North Pacific and North Atlantic. When the AO is strongly positive, a strong mid-latitude jet stream steers storms northward, reducing cold air outbreaks in the mid-latitudes. When the AO is strongly negative, a weaker, meandering jet dips farther south, allowing Arctic air to spill into the mid-latitudes. (source: https://www.climate.gov/news-features/understanding-climate/climate-variability-arctic-oscillation) <br><br></p>
<p>NAO - https://www.cpc.ncep.noaa.gov/products/precip/CWlink/pna/norm.nao.monthly.b5001.current.ascii <br> The NAO (North Atlantic Oscillation) is a weather phenomenon over the North Atlantic Ocean of fluctuations in the difference of atmospheric pressure at sea level (SLP) between the Icelandic Low and the Azores High. (source: https://en.wikipedia.org/wiki/North_Atlantic_oscillation <br><br></p>
<p>PNA - https://www.cpc.ncep.noaa.gov/products/precip/CWlink/pna/norm.pna.monthly.b5001.current.ascii <br> The Pacific/North American teleconnection pattern (PNA) is one of the most recognized, influential climate patterns in the Northern Hemisphere mid-latitudes beyond the tropics. It consists of anomalies in the geopotential height fields (typically at 700 or 500mb) observed over the western and eastern United States. It is important to note that the PNA has been found to be strongly influenced by the El Niño-Southern Oscillation (ENSO) phenomenon. The positive phase of the PNA pattern tends to be associated with Pacific warm episodes (El Niño), and the negative phase tends to be associated with Pacific cold episodes (La Niña). (source: https://legacy.climate.ncsu.edu/climate/patterns/pna) <br><br></p>
<p>nino3.4 - https://origin.cpc.ncep.noaa.gov/products/analysis_monitoring/ensostuff/detrend.nino34.ascii.txt <br> El Niño (La Niña) is a phenomenon in the equatorial Pacific Ocean characterized by a five consecutive 3-month running mean of sea surface temperature (SST) anomalies in the Niño 3.4 region that is above (below) the threshold of +0.5°C (-0.5°C). (source: https://www.ncei.noaa.gov/access/monitoring/enso/sst) <br><br></p>
<p>PDO - https://www.ncei.noaa.gov/pub/data/cmb/ersst/v5/index/ersst.v5.pdo.dat <br> The Pacific Decadal Oscillation (PDO) is often described as a long-lived El Niño-like pattern of Pacific climate variability (Zhang et al.&nbsp;1997). As seen with the better-known El Niño/Southern Oscillation (ENSO), extremes in the PDO pattern are marked by widespread variations in the Pacific Basin and the North American climate.(source: https://www.ncei.noaa.gov/access/monitoring/pdo/) <br><br></p>
<p>SOI - https://crudata.uea.ac.uk/cru/data/soi/soi.dat <br> The Southern Oscillation Index (SOI) is a standardized index based on the observed sea level pressure (SLP) differences between Tahiti and Darwin, Australia. The SOI is one measure of the large-scale fluctuations in air pressure occurring between the western and eastern tropical Pacific (i.e., the state of the Southern Oscillation) during El Niño and La Niña episodes. (source: https://www.ncei.noaa.gov/access/monitoring/enso/soi) <br><br></p>
<p>QBO - https://www.cpc.ncep.noaa.gov/data/indices/qbo.u50.index <br> The Quasi-Biennial Oscillation is a regular variation of the winds that blow high above the equator. Strong winds in the stratosphere travel in a belt around the planet, and every 14 months or so, these winds completely change direction. (source: https://www.metoffice.gov.uk/weather/learn-about/weather/atmosphere/quasi-biennial-oscillation) <br><br></p>
<p>Sunspots - https://services.swpc.noaa.gov/json/solar-cycle/observed-solar-cycle-indices.json <br> (source: https://en.wikipedia.org/wiki/Solar_activity_and_climate) <br><br></p>
<p>AMO - https://psl.noaa.gov/data/correlation/amon.us.data <br> The Atlantic Multi-decadal Oscillation (AMO) has been identified as a coherent mode of natural variability occurring in the North Atlantic Ocean with an estimated period of 60-80 years. It is based upon the average anomalies of sea surface temperatures (SST) in the North Atlantic basin, typically over 0-80N. (source: https://climatedataguide.ucar.edu/climate-data/atlantic-multi-decadal-oscillation-amo) <br><br></p>
<p>Siberian Snow Cover - http://climate.rutgers.edu/snowcover/files/moncov.eurasia.txt # sq. km <br> (source: https://www.nohrsc.noaa.gov/nh_snowcover/) <br><br></p>
<p>UK temperature - https://www.metoffice.gov.uk/pub/data/weather/uk/climate/datasets/Rainfall/date/England.txt <br> <br></p>
<p>UK rainfall - https://www.metoffice.gov.uk/pub/data/weather/uk/climate/datasets/Tmean/date/England.txt <br> <br> ***</p>
<p>First, let’s gather all of the data listed above:</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> io <span class="im">import</span> StringIO</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sn</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> pearsonr</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_absolute_error, r2_score</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_absolute_percentage_error</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> month_cols_to_rows(df, output_value_col_name):</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co">    Formats a string containing time series data to a pandas DataFrame</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co">    This function simply wraps the ``+`` operator, and does not</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co">    do anything interesting, except for illustrating what</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co">    the docstring of a very simple function looks like.</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co">    num1 : int</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co">        First number to add.</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co">    num2 : int</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co">        Second number to add.</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="co">    int</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="co">        The sum of ``num1`` and ``num2``.</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(df.columns) <span class="op">!=</span> <span class="dv">12</span>:</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'Are you sure there are 12 months (plus the year as index) present in this DataFrame?'</span>)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    new_df <span class="op">=</span> []</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> y <span class="kw">in</span> df.index:</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>        month_start <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> row <span class="kw">in</span> df[df.index <span class="op">==</span> y].values:</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> r <span class="kw">in</span> row:</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>                month_start <span class="op">=</span> month_start<span class="op">++</span><span class="dv">1</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>                new_df.append([y,month_start,r])</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    new_df<span class="op">=</span>pd.DataFrame(new_df)</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    new_df.columns <span class="op">=</span> [<span class="st">'Year'</span>, <span class="st">'Month'</span>, output_value_col_name]</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    <span class="co">#new_df = new_df.set_index('Year')</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> new_df</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> format_type_1(s):</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a><span class="co">    Formats a string containing time series data to a pandas DataFrame</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a><span class="co">    This function simply wraps the ``+`` operator, and does not</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="co">    do anything interesting, except for illustrating what</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a><span class="co">    the docstring of a very simple function looks like.</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a><span class="co">    num1 : int</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a><span class="co">        First number to add.</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a><span class="co">    num2 : int</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a><span class="co">        Second number to add.</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a><span class="co">    int</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a><span class="co">        The sum of ``num1`` and ``num2``.</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> StringIO(re.sub(<span class="st">' +'</span>, <span class="st">','</span>, s))</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>    d <span class="op">=</span> pd.read_csv(s)</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    <span class="co"># When reading a string as a CSV, pandas automatically assigns the first row as the header, </span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>    <span class="co"># we want to move that header back to the rows and recreate an appropriate header</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>    d.loc[<span class="bu">len</span>(d)] <span class="op">=</span> <span class="bu">list</span>(d.columns)</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>    d.columns <span class="op">=</span> np.arange(<span class="dv">0</span>,<span class="bu">len</span>(d.columns),<span class="dv">1</span>)</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> d</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">############################</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> requests.get(<span class="st">'http://climate.rutgers.edu/snowcover/files/moncov.eurasia.txt'</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>eurasian_snow_cover_data <span class="op">=</span> format_type_1(r.text)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>eurasian_snow_cover_data.columns <span class="op">=</span> [<span class="st">'Year'</span>, <span class="st">'Month'</span>, <span class="st">'Eurasian_Snow_Cover'</span>]</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>eurasian_snow_cover_data <span class="op">=</span> eurasian_snow_cover_data.<span class="bu">apply</span>(pd.to_numeric, errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>eurasian_snow_cover_data[<span class="st">'Eurasian_Snow_Cover'</span>] <span class="op">=</span> eurasian_snow_cover_data[<span class="st">'Eurasian_Snow_Cover'</span>]<span class="op">/</span><span class="fl">10e6</span> <span class="co"># Sq Km to Mil Sq km</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">#####################</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">############################</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># r = requests.get("https://www.metoffice.gov.uk/hadobs/hadcet/data/meantemp_daily_totals.txt")</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># s = StringIO(re.sub(' +', ',', r.text)) #replace all spaces (and consecutive spaces) with commas</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># CET = pd.read_csv(s)</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># CET = CET.set_index('Date')</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># CET['Year and Month'] = CET.index.str[:-3]</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># CE_Monthly = CET.groupby('Year and Month').mean()</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># CE_Monthly = CE_Monthly.reset_index()</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># CE_Monthly[['Year', 'Month']] = CE_Monthly['Year and Month'].str.split('-', expand=True)</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># CE_Monthly = CE_Monthly.drop(columns = 'Year and Month')</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># CE_Monthly = CE_Monthly.rename(columns={'Value':'CET Mean'})</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co">############################</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">############################</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> requests.get(<span class="st">"https://origin.cpc.ncep.noaa.gov/products/analysis_monitoring/ensostuff/detrend.nino34.ascii.txt"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> StringIO(re.sub(<span class="st">' +'</span>, <span class="st">','</span>, r.text[<span class="dv">1</span>:])) <span class="co">#replace all spaces (and consecutive spaces) with commas</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>Nino <span class="op">=</span> pd.read_csv(s)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>Nino <span class="op">=</span> Nino[[<span class="st">'YR'</span>,<span class="st">'MON'</span>,<span class="st">'TOTAL'</span>]]</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>Nino <span class="op">=</span> Nino.rename(columns <span class="op">=</span> {<span class="st">'YR'</span>:<span class="st">'Year'</span>,<span class="st">'MON'</span>:<span class="st">'Month'</span>,<span class="st">'TOTAL'</span>:<span class="st">'Nino3.4'</span>})</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>Nino <span class="op">=</span> Nino.<span class="bu">apply</span>(pd.to_numeric, errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">############################</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">############################</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> requests.get(<span class="st">"https://www.ncei.noaa.gov/pub/data/cmb/ersst/v5/index/ersst.v5.pdo.dat"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> StringIO(re.sub(<span class="st">' +'</span>, <span class="st">','</span>, r.text[<span class="dv">18</span>:])) <span class="co">#replace all spaces (and consecutive spaces) with commas</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>PDO <span class="op">=</span> pd.read_csv(s)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>PDO <span class="op">=</span> PDO.set_index(<span class="st">'Year'</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>PDO <span class="op">=</span> month_cols_to_rows(PDO, <span class="st">'PDO'</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>PDO <span class="op">=</span> PDO.<span class="bu">apply</span>(pd.to_numeric, errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">############################</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">############################</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> requests.get(<span class="st">"https://www.cpc.ncep.noaa.gov/data/indices/soi"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> StringIO(re.sub(<span class="st">' +'</span>, <span class="st">','</span>, r.text[<span class="dv">242</span>:<span class="op">-</span><span class="dv">6485</span>].replace(<span class="st">'-999.9'</span>,<span class="st">' '</span>))) <span class="co">#replace all spaces (and consecutive spaces) with commas</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>SOI <span class="op">=</span> pd.read_csv(s)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>SOI <span class="op">=</span> SOI.set_index(<span class="st">'YEAR'</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>SOI <span class="op">=</span> SOI.drop(columns <span class="op">=</span> [<span class="st">'Unnamed: 13'</span>])</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>SOI <span class="op">=</span> month_cols_to_rows(SOI, <span class="st">'SOI'</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>SOI <span class="op">=</span> SOI.<span class="bu">apply</span>(pd.to_numeric, errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">############################</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">############################</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>sunspots <span class="op">=</span> pd.read_json(<span class="st">"https://services.swpc.noaa.gov/json/solar-cycle/observed-solar-cycle-indices.json"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>sunspots <span class="op">=</span> sunspots[[<span class="st">'time-tag'</span>,<span class="st">'ssn'</span>]]</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>sunspots[[<span class="st">'Year'</span>, <span class="st">'Month'</span>]]<span class="op">=</span>sunspots[<span class="st">'time-tag'</span>].<span class="bu">str</span>.split(<span class="st">'-'</span>, expand<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>sunspots <span class="op">=</span> sunspots.drop(columns <span class="op">=</span> [<span class="st">'time-tag'</span>])</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>sunspots <span class="op">=</span> sunspots.rename(columns<span class="op">=</span>{<span class="st">'ssn'</span>: <span class="st">'Sunspots'</span>})</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>sunspots <span class="op">=</span> sunspots.<span class="bu">apply</span>(pd.to_numeric, errors<span class="op">=</span><span class="st">'coerce'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> requests.get(<span class="st">"https://www.cpc.ncep.noaa.gov/data/indices/qbo.u50.index"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> StringIO(re.sub(<span class="st">' +'</span>, <span class="st">','</span>, r.text[<span class="dv">243</span>:<span class="dv">4765</span>].replace(<span class="st">'-999.9'</span>,<span class="st">' '</span>)))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>QBO <span class="op">=</span> pd.read_csv(s)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>QBO <span class="op">=</span> QBO.drop(columns <span class="op">=</span> [<span class="st">'Unnamed: 13'</span>])</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>QBO <span class="op">=</span> QBO.set_index(<span class="st">'YEAR'</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>QBO <span class="op">=</span> month_cols_to_rows(QBO, <span class="st">'QBO'</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>QBO <span class="op">=</span> QBO.<span class="bu">apply</span>(pd.to_numeric, errors<span class="op">=</span><span class="st">'coerce'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#####################</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> requests.get(<span class="st">"https://psl.noaa.gov/data/correlation/amon.us.data"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>AMO <span class="op">=</span> format_type_1(r.text[<span class="dv">21</span>:<span class="op">-</span><span class="dv">135</span>])</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>AMO <span class="op">=</span> AMO.set_index(<span class="dv">0</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>AMO <span class="op">=</span> month_cols_to_rows(AMO, <span class="st">'AMO'</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>AMO <span class="op">=</span> AMO.<span class="bu">apply</span>(pd.to_numeric, errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">#####################</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#####################</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> requests.get(<span class="st">"https://www.cpc.ncep.noaa.gov/products/precip/CWlink/daily_ao_index/monthly.ao.index.b50.current.ascii"</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>AO <span class="op">=</span> format_type_1(r.text[<span class="dv">2</span>:])</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>AO.columns <span class="op">=</span> [<span class="st">'Year'</span>, <span class="st">'Month'</span>, <span class="st">'AO'</span>]</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>AO <span class="op">=</span> AO.<span class="bu">apply</span>(pd.to_numeric, errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">#####################</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#####################</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> requests.get(<span class="st">"https://www.cpc.ncep.noaa.gov/products/precip/CWlink/pna/norm.nao.monthly.b5001.current.ascii"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>NAO <span class="op">=</span> format_type_1(r.text[<span class="dv">2</span>:])</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>NAO.columns <span class="op">=</span> [<span class="st">'Year'</span>, <span class="st">'Month'</span>, <span class="st">'NAO'</span>]</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>NAO <span class="op">=</span> NAO.<span class="bu">apply</span>(pd.to_numeric, errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">#####################</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#####################</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> requests.get(<span class="st">"https://www.cpc.ncep.noaa.gov/products/precip/CWlink/pna/norm.pna.monthly.b5001.current.ascii"</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>PNA <span class="op">=</span> format_type_1(r.text[<span class="dv">2</span>:])</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>PNA.columns <span class="op">=</span> [<span class="st">'Year'</span>, <span class="st">'Month'</span>, <span class="st">'PNA'</span>]</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>PNA <span class="op">=</span> PNA.<span class="bu">apply</span>(pd.to_numeric, errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co">#####################</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">############################</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> requests.get(<span class="st">"https://www.metoffice.gov.uk/pub/data/weather/uk/climate/datasets/Rainfall/date/England.txt"</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> StringIO(re.sub(<span class="st">' +'</span>, <span class="st">','</span>, r.text[<span class="dv">264</span>:]))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>UK_rainfall <span class="op">=</span> pd.read_csv(s)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>UK_rainfall <span class="op">=</span> UK_rainfall.drop(columns <span class="op">=</span> [<span class="st">'win'</span>,<span class="st">'spr'</span>,<span class="st">'sum'</span>,<span class="st">'aut'</span>,<span class="st">'ann'</span>])</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>UK_rainfall <span class="op">=</span> UK_rainfall.set_index(<span class="st">'year'</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>UK_rainfall <span class="op">=</span> month_cols_to_rows(UK_rainfall, <span class="st">'UK_rainfall'</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>UK_rainfall <span class="op">=</span> UK_rainfall.<span class="bu">apply</span>(pd.to_numeric, errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co">############################</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">############################</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> requests.get(<span class="st">"https://www.metoffice.gov.uk/pub/data/weather/uk/climate/datasets/Tmean/date/England.txt"</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> StringIO(re.sub(<span class="st">' +'</span>, <span class="st">','</span>, r.text[<span class="dv">259</span>:]))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>UK_mean_temp <span class="op">=</span> pd.read_csv(s)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>UK_mean_temp <span class="op">=</span> UK_mean_temp.drop(columns <span class="op">=</span> [<span class="st">'win'</span>,<span class="st">'spr'</span>,<span class="st">'sum'</span>,<span class="st">'aut'</span>,<span class="st">'ann'</span>])</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>UK_mean_temp <span class="op">=</span> UK_mean_temp.set_index(<span class="st">'year'</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>UK_mean_temp <span class="op">=</span> month_cols_to_rows(UK_mean_temp, <span class="st">'UK_mean_temp'</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>UK_mean_temp <span class="op">=</span> UK_mean_temp.<span class="bu">apply</span>(pd.to_numeric, errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co">############################</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>features_df <span class="op">=</span> pd.merge(eurasian_snow_cover_data,SOI, on<span class="op">=</span>[<span class="st">'Year'</span>, <span class="st">'Month'</span>])</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>features_df <span class="op">=</span> pd.merge(features_df,Nino, on<span class="op">=</span>[<span class="st">'Year'</span>, <span class="st">'Month'</span>])</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>features_df <span class="op">=</span> pd.merge(features_df,PDO, on<span class="op">=</span>[<span class="st">'Year'</span>, <span class="st">'Month'</span>])</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>features_df <span class="op">=</span> pd.merge(features_df,sunspots, on<span class="op">=</span>[<span class="st">'Year'</span>, <span class="st">'Month'</span>])</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>features_df <span class="op">=</span> pd.merge(features_df,QBO, on<span class="op">=</span>[<span class="st">'Year'</span>, <span class="st">'Month'</span>])</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>features_df <span class="op">=</span> pd.merge(features_df,AMO, on<span class="op">=</span>[<span class="st">'Year'</span>, <span class="st">'Month'</span>])</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>features_df <span class="op">=</span> pd.merge(features_df,AO, on<span class="op">=</span>[<span class="st">'Year'</span>, <span class="st">'Month'</span>])</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>features_df <span class="op">=</span> pd.merge(features_df,NAO, on<span class="op">=</span>[<span class="st">'Year'</span>, <span class="st">'Month'</span>])</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>features_df <span class="op">=</span> pd.merge(features_df,PNA, on<span class="op">=</span>[<span class="st">'Year'</span>, <span class="st">'Month'</span>])</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>features_df <span class="op">=</span> pd.merge(features_df,UK_rainfall, on<span class="op">=</span>[<span class="st">'Year'</span>, <span class="st">'Month'</span>])</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>features_df <span class="op">=</span> pd.merge(features_df,UK_mean_temp, on<span class="op">=</span>[<span class="st">'Year'</span>, <span class="st">'Month'</span>])</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>features_df <span class="op">=</span> features_df.sort_values(by<span class="op">=</span>[<span class="st">'Year'</span>, <span class="st">'Month'</span>])</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>features_df[<span class="st">'Year and Month'</span>] <span class="op">=</span> pd.to_datetime(features_df[<span class="st">'Year'</span>].astype(<span class="bu">str</span>)<span class="op">+</span><span class="st">"-"</span><span class="op">+</span>features_df[<span class="st">'Month'</span>].astype(<span class="bu">str</span>), <span class="bu">format</span> <span class="op">=</span> <span class="st">'%Y-%m'</span>)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>features_df <span class="op">=</span> features_df.set_index(<span class="st">'Year and Month'</span>)</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>features_df <span class="op">=</span> features_df.drop(columns <span class="op">=</span> [<span class="st">'Year'</span>, <span class="st">'Month'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>Great, now the data needs a bit of cleaning:</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>features_df <span class="op">=</span> features_df.replace(<span class="fl">99.99</span>, np.nan)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>features_df <span class="op">=</span> features_df.replace(<span class="op">-</span><span class="fl">99.99</span>, np.nan)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(features_df.isna().<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>features_df <span class="op">=</span> features_df.interpolate() <span class="co"># interpolate between points around missing values, if there's a Nan at the last row, just use the previous months value</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Year and Month
1979-01-01    0
1979-02-01    0
1979-03-01    0
1979-04-01    0
1979-05-01    0
             ..
2022-05-01    0
2022-06-01    0
2022-07-01    0
2022-08-01    0
2022-09-01    0
Length: 525, dtype: int64</code></pre>
</div>
</div>
<p>Now, we need to get the mean temperature for a given winter. Because the winter months overlap with multiple years (i.e.&nbsp;December, January and Feburary), we need to account for this. For ease of usability, we will simply take the first year of the winter period as it’s identifying year. This saves us having to use a string such as ‘2020/2021’, which is a bit more cumbersome to filter by.</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>pd.options.mode.chained_assignment <span class="op">=</span> <span class="va">None</span>  <span class="co"># default='warn' </span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> combine_winters(features_df, winter_months):</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    winter_month_mask <span class="op">=</span> [x <span class="kw">in</span> winter_months <span class="cf">for</span> x <span class="kw">in</span> features_df.index.month]</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    all_winters <span class="op">=</span> features_df.loc[winter_month_mask,:]</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    all_winters.loc[:,<span class="st">'Winter Start Year'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ind <span class="kw">in</span> all_winters.index:</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ind.month <span class="op">&gt;</span> <span class="dv">11</span>:</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>            all_winters.loc[ind, <span class="st">'Winter Start Year'</span>] <span class="op">=</span> ind.year</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> ind.month <span class="op">&lt;</span> <span class="dv">3</span>:</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>            all_winters.loc[ind, <span class="st">'Winter Start Year'</span>] <span class="op">=</span> ind.year<span class="op">-</span><span class="dv">1</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    all_winter_means <span class="op">=</span> all_winters.groupby(<span class="st">'Winter Start Year'</span>).mean()[<span class="st">'UK_mean_temp'</span>]<span class="co">#.values</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    all_winter_means.name <span class="op">=</span> <span class="st">'Winter Mean Temperature'</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> all_winters, all_winter_means</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>winter_months <span class="op">=</span> [<span class="dv">12</span>,<span class="dv">1</span>,<span class="dv">2</span>]</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>all_winters, all_winter_means <span class="op">=</span> combine_winters(features_df, winter_months)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Some EDA:</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>all_winter_means.plot(legend<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>&lt;AxesSubplot:xlabel='Winter Start Year'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Winter%20Temperature%20Prediction_files/figure-html/cell-19-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Unsurprisingly, the data shows that UK Winters are getting warmer (likely as a result of climate change). Let’s have a play witht data to see what it shows. Below, I’ll look at the data for November and see how well it is correlated to the winter mean temperature.</p>
<div class="cell" data-scrolled="true" data-execution_count="19">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>all_months_with_winter_means <span class="op">=</span> pd.merge(features_df,all_winter_means, left_on<span class="op">=</span>features_df.index.year, right_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>all_months_with_winter_means <span class="op">=</span> all_months_with_winter_means.drop(columns<span class="op">=</span>[<span class="st">'key_0'</span>])</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>corr_mat <span class="op">=</span> all_months_with_winter_means[all_months_with_winter_means.index.month<span class="op">==</span><span class="dv">11</span>].corr()</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>sn.heatmap(corr_mat, annot<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>pd.plotting.scatter_matrix(all_months_with_winter_means[all_months_with_winter_means.index.month<span class="op">==</span><span class="dv">11</span>], diagonal<span class="op">=</span><span class="st">'kde'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Winter%20Temperature%20Prediction_files/figure-html/cell-20-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>array([[&lt;AxesSubplot:xlabel='Eurasian_Snow_Cover', ylabel='Eurasian_Snow_Cover'&gt;,
        &lt;AxesSubplot:xlabel='SOI', ylabel='Eurasian_Snow_Cover'&gt;,
        &lt;AxesSubplot:xlabel='Nino3.4', ylabel='Eurasian_Snow_Cover'&gt;,
        &lt;AxesSubplot:xlabel='PDO', ylabel='Eurasian_Snow_Cover'&gt;,
        &lt;AxesSubplot:xlabel='Sunspots', ylabel='Eurasian_Snow_Cover'&gt;,
        &lt;AxesSubplot:xlabel='QBO', ylabel='Eurasian_Snow_Cover'&gt;,
        &lt;AxesSubplot:xlabel='AMO', ylabel='Eurasian_Snow_Cover'&gt;,
        &lt;AxesSubplot:xlabel='AO', ylabel='Eurasian_Snow_Cover'&gt;,
        &lt;AxesSubplot:xlabel='NAO', ylabel='Eurasian_Snow_Cover'&gt;,
        &lt;AxesSubplot:xlabel='PNA', ylabel='Eurasian_Snow_Cover'&gt;,
        &lt;AxesSubplot:xlabel='UK_rainfall', ylabel='Eurasian_Snow_Cover'&gt;,
        &lt;AxesSubplot:xlabel='UK_mean_temp', ylabel='Eurasian_Snow_Cover'&gt;,
        &lt;AxesSubplot:xlabel='Winter Mean Temperature', ylabel='Eurasian_Snow_Cover'&gt;],
       [&lt;AxesSubplot:xlabel='Eurasian_Snow_Cover', ylabel='SOI'&gt;,
        &lt;AxesSubplot:xlabel='SOI', ylabel='SOI'&gt;,
        &lt;AxesSubplot:xlabel='Nino3.4', ylabel='SOI'&gt;,
        &lt;AxesSubplot:xlabel='PDO', ylabel='SOI'&gt;,
        &lt;AxesSubplot:xlabel='Sunspots', ylabel='SOI'&gt;,
        &lt;AxesSubplot:xlabel='QBO', ylabel='SOI'&gt;,
        &lt;AxesSubplot:xlabel='AMO', ylabel='SOI'&gt;,
        &lt;AxesSubplot:xlabel='AO', ylabel='SOI'&gt;,
        &lt;AxesSubplot:xlabel='NAO', ylabel='SOI'&gt;,
        &lt;AxesSubplot:xlabel='PNA', ylabel='SOI'&gt;,
        &lt;AxesSubplot:xlabel='UK_rainfall', ylabel='SOI'&gt;,
        &lt;AxesSubplot:xlabel='UK_mean_temp', ylabel='SOI'&gt;,
        &lt;AxesSubplot:xlabel='Winter Mean Temperature', ylabel='SOI'&gt;],
       [&lt;AxesSubplot:xlabel='Eurasian_Snow_Cover', ylabel='Nino3.4'&gt;,
        &lt;AxesSubplot:xlabel='SOI', ylabel='Nino3.4'&gt;,
        &lt;AxesSubplot:xlabel='Nino3.4', ylabel='Nino3.4'&gt;,
        &lt;AxesSubplot:xlabel='PDO', ylabel='Nino3.4'&gt;,
        &lt;AxesSubplot:xlabel='Sunspots', ylabel='Nino3.4'&gt;,
        &lt;AxesSubplot:xlabel='QBO', ylabel='Nino3.4'&gt;,
        &lt;AxesSubplot:xlabel='AMO', ylabel='Nino3.4'&gt;,
        &lt;AxesSubplot:xlabel='AO', ylabel='Nino3.4'&gt;,
        &lt;AxesSubplot:xlabel='NAO', ylabel='Nino3.4'&gt;,
        &lt;AxesSubplot:xlabel='PNA', ylabel='Nino3.4'&gt;,
        &lt;AxesSubplot:xlabel='UK_rainfall', ylabel='Nino3.4'&gt;,
        &lt;AxesSubplot:xlabel='UK_mean_temp', ylabel='Nino3.4'&gt;,
        &lt;AxesSubplot:xlabel='Winter Mean Temperature', ylabel='Nino3.4'&gt;],
       [&lt;AxesSubplot:xlabel='Eurasian_Snow_Cover', ylabel='PDO'&gt;,
        &lt;AxesSubplot:xlabel='SOI', ylabel='PDO'&gt;,
        &lt;AxesSubplot:xlabel='Nino3.4', ylabel='PDO'&gt;,
        &lt;AxesSubplot:xlabel='PDO', ylabel='PDO'&gt;,
        &lt;AxesSubplot:xlabel='Sunspots', ylabel='PDO'&gt;,
        &lt;AxesSubplot:xlabel='QBO', ylabel='PDO'&gt;,
        &lt;AxesSubplot:xlabel='AMO', ylabel='PDO'&gt;,
        &lt;AxesSubplot:xlabel='AO', ylabel='PDO'&gt;,
        &lt;AxesSubplot:xlabel='NAO', ylabel='PDO'&gt;,
        &lt;AxesSubplot:xlabel='PNA', ylabel='PDO'&gt;,
        &lt;AxesSubplot:xlabel='UK_rainfall', ylabel='PDO'&gt;,
        &lt;AxesSubplot:xlabel='UK_mean_temp', ylabel='PDO'&gt;,
        &lt;AxesSubplot:xlabel='Winter Mean Temperature', ylabel='PDO'&gt;],
       [&lt;AxesSubplot:xlabel='Eurasian_Snow_Cover', ylabel='Sunspots'&gt;,
        &lt;AxesSubplot:xlabel='SOI', ylabel='Sunspots'&gt;,
        &lt;AxesSubplot:xlabel='Nino3.4', ylabel='Sunspots'&gt;,
        &lt;AxesSubplot:xlabel='PDO', ylabel='Sunspots'&gt;,
        &lt;AxesSubplot:xlabel='Sunspots', ylabel='Sunspots'&gt;,
        &lt;AxesSubplot:xlabel='QBO', ylabel='Sunspots'&gt;,
        &lt;AxesSubplot:xlabel='AMO', ylabel='Sunspots'&gt;,
        &lt;AxesSubplot:xlabel='AO', ylabel='Sunspots'&gt;,
        &lt;AxesSubplot:xlabel='NAO', ylabel='Sunspots'&gt;,
        &lt;AxesSubplot:xlabel='PNA', ylabel='Sunspots'&gt;,
        &lt;AxesSubplot:xlabel='UK_rainfall', ylabel='Sunspots'&gt;,
        &lt;AxesSubplot:xlabel='UK_mean_temp', ylabel='Sunspots'&gt;,
        &lt;AxesSubplot:xlabel='Winter Mean Temperature', ylabel='Sunspots'&gt;],
       [&lt;AxesSubplot:xlabel='Eurasian_Snow_Cover', ylabel='QBO'&gt;,
        &lt;AxesSubplot:xlabel='SOI', ylabel='QBO'&gt;,
        &lt;AxesSubplot:xlabel='Nino3.4', ylabel='QBO'&gt;,
        &lt;AxesSubplot:xlabel='PDO', ylabel='QBO'&gt;,
        &lt;AxesSubplot:xlabel='Sunspots', ylabel='QBO'&gt;,
        &lt;AxesSubplot:xlabel='QBO', ylabel='QBO'&gt;,
        &lt;AxesSubplot:xlabel='AMO', ylabel='QBO'&gt;,
        &lt;AxesSubplot:xlabel='AO', ylabel='QBO'&gt;,
        &lt;AxesSubplot:xlabel='NAO', ylabel='QBO'&gt;,
        &lt;AxesSubplot:xlabel='PNA', ylabel='QBO'&gt;,
        &lt;AxesSubplot:xlabel='UK_rainfall', ylabel='QBO'&gt;,
        &lt;AxesSubplot:xlabel='UK_mean_temp', ylabel='QBO'&gt;,
        &lt;AxesSubplot:xlabel='Winter Mean Temperature', ylabel='QBO'&gt;],
       [&lt;AxesSubplot:xlabel='Eurasian_Snow_Cover', ylabel='AMO'&gt;,
        &lt;AxesSubplot:xlabel='SOI', ylabel='AMO'&gt;,
        &lt;AxesSubplot:xlabel='Nino3.4', ylabel='AMO'&gt;,
        &lt;AxesSubplot:xlabel='PDO', ylabel='AMO'&gt;,
        &lt;AxesSubplot:xlabel='Sunspots', ylabel='AMO'&gt;,
        &lt;AxesSubplot:xlabel='QBO', ylabel='AMO'&gt;,
        &lt;AxesSubplot:xlabel='AMO', ylabel='AMO'&gt;,
        &lt;AxesSubplot:xlabel='AO', ylabel='AMO'&gt;,
        &lt;AxesSubplot:xlabel='NAO', ylabel='AMO'&gt;,
        &lt;AxesSubplot:xlabel='PNA', ylabel='AMO'&gt;,
        &lt;AxesSubplot:xlabel='UK_rainfall', ylabel='AMO'&gt;,
        &lt;AxesSubplot:xlabel='UK_mean_temp', ylabel='AMO'&gt;,
        &lt;AxesSubplot:xlabel='Winter Mean Temperature', ylabel='AMO'&gt;],
       [&lt;AxesSubplot:xlabel='Eurasian_Snow_Cover', ylabel='AO'&gt;,
        &lt;AxesSubplot:xlabel='SOI', ylabel='AO'&gt;,
        &lt;AxesSubplot:xlabel='Nino3.4', ylabel='AO'&gt;,
        &lt;AxesSubplot:xlabel='PDO', ylabel='AO'&gt;,
        &lt;AxesSubplot:xlabel='Sunspots', ylabel='AO'&gt;,
        &lt;AxesSubplot:xlabel='QBO', ylabel='AO'&gt;,
        &lt;AxesSubplot:xlabel='AMO', ylabel='AO'&gt;,
        &lt;AxesSubplot:xlabel='AO', ylabel='AO'&gt;,
        &lt;AxesSubplot:xlabel='NAO', ylabel='AO'&gt;,
        &lt;AxesSubplot:xlabel='PNA', ylabel='AO'&gt;,
        &lt;AxesSubplot:xlabel='UK_rainfall', ylabel='AO'&gt;,
        &lt;AxesSubplot:xlabel='UK_mean_temp', ylabel='AO'&gt;,
        &lt;AxesSubplot:xlabel='Winter Mean Temperature', ylabel='AO'&gt;],
       [&lt;AxesSubplot:xlabel='Eurasian_Snow_Cover', ylabel='NAO'&gt;,
        &lt;AxesSubplot:xlabel='SOI', ylabel='NAO'&gt;,
        &lt;AxesSubplot:xlabel='Nino3.4', ylabel='NAO'&gt;,
        &lt;AxesSubplot:xlabel='PDO', ylabel='NAO'&gt;,
        &lt;AxesSubplot:xlabel='Sunspots', ylabel='NAO'&gt;,
        &lt;AxesSubplot:xlabel='QBO', ylabel='NAO'&gt;,
        &lt;AxesSubplot:xlabel='AMO', ylabel='NAO'&gt;,
        &lt;AxesSubplot:xlabel='AO', ylabel='NAO'&gt;,
        &lt;AxesSubplot:xlabel='NAO', ylabel='NAO'&gt;,
        &lt;AxesSubplot:xlabel='PNA', ylabel='NAO'&gt;,
        &lt;AxesSubplot:xlabel='UK_rainfall', ylabel='NAO'&gt;,
        &lt;AxesSubplot:xlabel='UK_mean_temp', ylabel='NAO'&gt;,
        &lt;AxesSubplot:xlabel='Winter Mean Temperature', ylabel='NAO'&gt;],
       [&lt;AxesSubplot:xlabel='Eurasian_Snow_Cover', ylabel='PNA'&gt;,
        &lt;AxesSubplot:xlabel='SOI', ylabel='PNA'&gt;,
        &lt;AxesSubplot:xlabel='Nino3.4', ylabel='PNA'&gt;,
        &lt;AxesSubplot:xlabel='PDO', ylabel='PNA'&gt;,
        &lt;AxesSubplot:xlabel='Sunspots', ylabel='PNA'&gt;,
        &lt;AxesSubplot:xlabel='QBO', ylabel='PNA'&gt;,
        &lt;AxesSubplot:xlabel='AMO', ylabel='PNA'&gt;,
        &lt;AxesSubplot:xlabel='AO', ylabel='PNA'&gt;,
        &lt;AxesSubplot:xlabel='NAO', ylabel='PNA'&gt;,
        &lt;AxesSubplot:xlabel='PNA', ylabel='PNA'&gt;,
        &lt;AxesSubplot:xlabel='UK_rainfall', ylabel='PNA'&gt;,
        &lt;AxesSubplot:xlabel='UK_mean_temp', ylabel='PNA'&gt;,
        &lt;AxesSubplot:xlabel='Winter Mean Temperature', ylabel='PNA'&gt;],
       [&lt;AxesSubplot:xlabel='Eurasian_Snow_Cover', ylabel='UK_rainfall'&gt;,
        &lt;AxesSubplot:xlabel='SOI', ylabel='UK_rainfall'&gt;,
        &lt;AxesSubplot:xlabel='Nino3.4', ylabel='UK_rainfall'&gt;,
        &lt;AxesSubplot:xlabel='PDO', ylabel='UK_rainfall'&gt;,
        &lt;AxesSubplot:xlabel='Sunspots', ylabel='UK_rainfall'&gt;,
        &lt;AxesSubplot:xlabel='QBO', ylabel='UK_rainfall'&gt;,
        &lt;AxesSubplot:xlabel='AMO', ylabel='UK_rainfall'&gt;,
        &lt;AxesSubplot:xlabel='AO', ylabel='UK_rainfall'&gt;,
        &lt;AxesSubplot:xlabel='NAO', ylabel='UK_rainfall'&gt;,
        &lt;AxesSubplot:xlabel='PNA', ylabel='UK_rainfall'&gt;,
        &lt;AxesSubplot:xlabel='UK_rainfall', ylabel='UK_rainfall'&gt;,
        &lt;AxesSubplot:xlabel='UK_mean_temp', ylabel='UK_rainfall'&gt;,
        &lt;AxesSubplot:xlabel='Winter Mean Temperature', ylabel='UK_rainfall'&gt;],
       [&lt;AxesSubplot:xlabel='Eurasian_Snow_Cover', ylabel='UK_mean_temp'&gt;,
        &lt;AxesSubplot:xlabel='SOI', ylabel='UK_mean_temp'&gt;,
        &lt;AxesSubplot:xlabel='Nino3.4', ylabel='UK_mean_temp'&gt;,
        &lt;AxesSubplot:xlabel='PDO', ylabel='UK_mean_temp'&gt;,
        &lt;AxesSubplot:xlabel='Sunspots', ylabel='UK_mean_temp'&gt;,
        &lt;AxesSubplot:xlabel='QBO', ylabel='UK_mean_temp'&gt;,
        &lt;AxesSubplot:xlabel='AMO', ylabel='UK_mean_temp'&gt;,
        &lt;AxesSubplot:xlabel='AO', ylabel='UK_mean_temp'&gt;,
        &lt;AxesSubplot:xlabel='NAO', ylabel='UK_mean_temp'&gt;,
        &lt;AxesSubplot:xlabel='PNA', ylabel='UK_mean_temp'&gt;,
        &lt;AxesSubplot:xlabel='UK_rainfall', ylabel='UK_mean_temp'&gt;,
        &lt;AxesSubplot:xlabel='UK_mean_temp', ylabel='UK_mean_temp'&gt;,
        &lt;AxesSubplot:xlabel='Winter Mean Temperature', ylabel='UK_mean_temp'&gt;],
       [&lt;AxesSubplot:xlabel='Eurasian_Snow_Cover', ylabel='Winter Mean Temperature'&gt;,
        &lt;AxesSubplot:xlabel='SOI', ylabel='Winter Mean Temperature'&gt;,
        &lt;AxesSubplot:xlabel='Nino3.4', ylabel='Winter Mean Temperature'&gt;,
        &lt;AxesSubplot:xlabel='PDO', ylabel='Winter Mean Temperature'&gt;,
        &lt;AxesSubplot:xlabel='Sunspots', ylabel='Winter Mean Temperature'&gt;,
        &lt;AxesSubplot:xlabel='QBO', ylabel='Winter Mean Temperature'&gt;,
        &lt;AxesSubplot:xlabel='AMO', ylabel='Winter Mean Temperature'&gt;,
        &lt;AxesSubplot:xlabel='AO', ylabel='Winter Mean Temperature'&gt;,
        &lt;AxesSubplot:xlabel='NAO', ylabel='Winter Mean Temperature'&gt;,
        &lt;AxesSubplot:xlabel='PNA', ylabel='Winter Mean Temperature'&gt;,
        &lt;AxesSubplot:xlabel='UK_rainfall', ylabel='Winter Mean Temperature'&gt;,
        &lt;AxesSubplot:xlabel='UK_mean_temp', ylabel='Winter Mean Temperature'&gt;,
        &lt;AxesSubplot:xlabel='Winter Mean Temperature', ylabel='Winter Mean Temperature'&gt;]],
      dtype=object)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Winter%20Temperature%20Prediction_files/figure-html/cell-20-output-3.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> all_months_with_winter_means[<span class="st">'AMO'</span>].plot(legend<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>all_months_with_winter_means[<span class="st">'Winter Mean Temperature'</span>].plot(ax<span class="op">=</span>ax, secondary_y<span class="op">=</span><span class="va">True</span>, legend<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>&lt;AxesSubplot:&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Winter%20Temperature%20Prediction_files/figure-html/cell-21-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Looks like the AMO is the best correlated feature with Winter Mean. The AMO is a measure of log term sea surface temperature in the North Atlantic ocean. A positive correlation indicates that when the AMO cooler in November, this implies the UK may experience a colder winter overall. However, this could be a case of correlation not equaling causation, as the sea surface temperature has been increasing due to climate changes, while UK winters have been getting warmer. ***</p>
</section>
<section id="method-1-finding-analogues" class="level2">
<h2 class="anchored" data-anchor-id="method-1-finding-analogues">Method 1: Finding Analogues</h2>
<p>Now that we have all of the data, we can begin our analysis. Firstly, let’s try to find analogues to the data we are interested in, i.e.&nbsp;have there been any similar weather patterns seen in the past, and if so, did those years produce cold winters?</p>
<p>We do this by selecting a month that we are interested in, such as September 2022, and calculate the Euclidian Distance of that month to all previous Septembers:</p>
<p><span class="math display">\[ s = \sqrt{\sum_{i=1}^{n} (a_i - b_i)} \]</span>, where n is the number of features </p>
<p>If we chose multiple months, we can take the average of the ED for each month we choose. <br> <br> For example, let’s say we wanted to find the most similar Septembers and Octobers to September/October 2022. The function ‘find_analogue_years’ will return the top n most similar year, and the ‘get_temperatures_of_similar_years’ will find the mean winter temperature of those years, which we can then compare to the actual mean winter temperature of the selected year.</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co">#######################################################################</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> euclidian(arr_a, arr_b):</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.<span class="bu">sum</span>((arr_a<span class="op">-</span>arr_b)<span class="op">**</span><span class="dv">2</span>)<span class="op">**</span><span class="fl">0.5</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_analogue_years(search_months, search_year, n_analogues):</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    month_mask <span class="op">=</span> [x <span class="kw">in</span> search_months <span class="cf">for</span> x <span class="kw">in</span> features_df.index.month]</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    months_to_search_for <span class="op">=</span> features_df[month_mask <span class="op">&amp;</span> (features_df.index.year<span class="op">==</span>search_year)]</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">############# </span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>    months_to_search <span class="op">=</span> features_df[month_mask]</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>    years <span class="op">=</span> pd.DataFrame([], columns <span class="op">=</span> [<span class="st">'Similarity'</span>])</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ind, data <span class="kw">in</span> months_to_search.iterrows():</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ind.year <span class="op">==</span> search_year:</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>        ed <span class="op">=</span> euclidian(data.values, months_to_search_for.values)</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ind.year <span class="kw">in</span> years.index:</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>            <span class="co">#years.loc[ind.year]=np.mean([years.loc[ind.year].values[0], abs(row[['Nino3.4', 'AMO', 'AO', 'NAO']].values -months_to_search_for[['Nino3.4', 'AMO', 'AO', 'NAO']].values).sum()])</span></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>            years.loc[ind.year]<span class="op">=</span>np.nanmean([years.loc[ind.year].values[<span class="dv">0</span>], ed])</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>            <span class="co">#years.loc[ind.year]=abs(row[['Nino3.4', 'AMO', 'AO', 'NAO']].values -months_to_search_for[['Nino3.4', 'AMO', 'AO', 'NAO']].values).sum()</span></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>            years.loc[ind.year]<span class="op">=</span>ed</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>    most_similar_years <span class="op">=</span> years.nsmallest(n_analogues, <span class="st">'Similarity'</span>)</span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> most_similar_years</span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_temperatures_of_similar_years(all_winters, most_similar_years):</span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>    temps <span class="op">=</span> []</span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> y <span class="kw">in</span> most_similar_years.index:</span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>        temps.append(all_winters.loc[(all_winters[<span class="st">'Winter Start Year'</span>] <span class="op">==</span>y)][<span class="st">'UK_mean_temp'</span>].mean())</span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>    temps <span class="op">=</span> np.array(temps)</span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> temps</span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Finding Analogues</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>months <span class="op">=</span> [<span class="dv">9</span>]</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>current_year <span class="op">=</span> <span class="dv">2022</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>most_similar_years <span class="op">=</span> find_analogue_years(months, current_year, <span class="dv">3</span>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>temps <span class="op">=</span> get_temperatures_of_similar_years(all_winters, most_similar_years)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>plt.hist(all_winter_means)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>plt.axvline(np.mean(all_winter_means), c<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>plt.axvline(np.mean(all_winter_means)<span class="op">+</span>np.std(all_winter_means), c<span class="op">=</span><span class="st">'yellow'</span>)</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>plt.axvline(np.mean(all_winter_means)<span class="op">-</span>np.std(all_winter_means), c<span class="op">=</span><span class="st">'yellow'</span>)</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>plt.hist(temps)    </span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>percentile <span class="op">=</span> stats.percentileofscore(all_winter_means.values, np.mean(temps))</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Prediction: this winter (as compared with the data from </span><span class="sc">{date}</span><span class="st">) </span><span class="ch">\n</span><span class="st">will be in the </span><span class="sc">{p}</span><span class="st">th percentile of all UK winters in the dataset"</span>.<span class="bu">format</span>(date <span class="op">=</span> current_year, p <span class="op">=</span> <span class="bu">round</span>(<span class="dv">100</span><span class="op">-</span>percentile,<span class="dv">2</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Prediction: this winter (as compared with the data from 2022) 
will be in the 63.64th percentile of all UK winters in the dataset</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Winter%20Temperature%20Prediction_files/figure-html/cell-23-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>As we can see from the histogram generated, most UK winters tend to be between 3°C - 5.5°C. We can also see that for 2022, the average of the most similar years is ~4°C, well within the bounds of a ‘normal’ UK winter.</p>
<p>But does this mean anything? Is this prediction method any good?</p>
<p>We now need to test how reliable this method is.So let’s see how well the predicted temperatures match the actual temperatures over the entire dataset.</p>
<div class="cell" data-execution_count="128">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co">############################################################################</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> evaluate_method1(all_winters, months_to_check,axs, subplotx, subploty):</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"################"</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Months: "</span><span class="op">+</span><span class="bu">str</span>(months_to_check))</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    predicted_based_on_analogues <span class="op">=</span> []</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    actual_winter_temps <span class="op">=</span> []</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> np.arange(<span class="bu">min</span>(all_winters.index.year),<span class="bu">max</span>(all_winters.index.year),<span class="dv">1</span>):</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>        similar_years <span class="op">=</span> find_analogue_years(months_to_check, i, <span class="dv">2</span>)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>        temps <span class="op">=</span> get_temperatures_of_similar_years(all_winters, similar_years)</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>        predicted_based_on_analogues.append(np.nanmean(temps))</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>        actual_winter_temps.append(all_winter_means[all_winter_means.index<span class="op">==</span>i].values[<span class="dv">0</span>])</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    axs[subplotx,subploty].set_title(<span class="st">"Months: "</span><span class="op">+</span><span class="st">','</span>.join(<span class="bu">str</span>(i) <span class="cf">for</span> i <span class="kw">in</span> months_to_check))</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>    axs[subplotx,subploty].set_xlabel(<span class="st">'Actual Winter Mean Temperatures'</span>)</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>    axs[subplotx,subploty].set_ylabel(<span class="st">'Predicted Winter Mean</span><span class="ch">\n</span><span class="st"> Temperatures </span><span class="ch">\n</span><span class="st">(based on analogue years)'</span>)</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>    axs[subplotx,subploty].plot(np.array(actual_winter_temps), np.array(actual_winter_temps), c<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>    axs[subplotx,subploty].scatter(np.array(actual_winter_temps), np.array(predicted_based_on_analogues))</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>    corr, _ <span class="op">=</span> pearsonr(np.array(actual_winter_temps), np.array(predicted_based_on_analogues))</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Correlation: "</span><span class="op">+</span> <span class="bu">str</span>(corr))</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Covariance: </span><span class="ch">\n</span><span class="st">'</span><span class="op">+</span> <span class="bu">str</span>(np.cov(np.array(actual_winter_temps), np.array(predicted_based_on_analogues))))</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'r^2:'</span><span class="op">+</span> <span class="bu">str</span>(r2_score(np.array(actual_winter_temps), np.array(predicted_based_on_analogues))))</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">3</span>,<span class="dv">2</span>)</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>fig.tight_layout(pad<span class="op">=</span><span class="fl">3.0</span>)</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>months_to_check <span class="op">=</span> [<span class="dv">9</span>,]</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>evaluate_method1(all_winters, months_to_check,axs, <span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>months_to_check <span class="op">=</span> [<span class="dv">10</span>,]</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>evaluate_method1(all_winters, months_to_check,axs, <span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>months_to_check <span class="op">=</span> [<span class="dv">11</span>,]</span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>evaluate_method1(all_winters, months_to_check,axs, <span class="dv">2</span>,<span class="dv">0</span>)</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>months_to_check <span class="op">=</span> [<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>]</span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>evaluate_method1(all_winters, months_to_check,axs, <span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>months_to_check <span class="op">=</span> [<span class="dv">9</span>,<span class="dv">10</span>]</span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>evaluate_method1(all_winters, months_to_check,axs, <span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>months_to_check <span class="op">=</span> [<span class="dv">10</span>,<span class="dv">11</span>]</span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a>evaluate_method1(all_winters, months_to_check,axs, <span class="dv">2</span>,<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>################
Months: [9]
Correlation: 0.2793496919412732
Covariance: 
[[1.29841024 0.28562262]
 [0.28562262 0.80515012]]
r^2:-0.18055949102460334
################
Months: [10]
Correlation: 0.015190011242696783
Covariance: 
[[1.29841024 0.01461886]
 [0.01461886 0.7133441 ]]
r^2:-0.5402535305500853
################
Months: [11]
Correlation: 0.18494080817878106
Covariance: 
[[1.29841024 0.17115971]
 [0.17115971 0.65966839]]
r^2:-0.26662322382673564
################
Months: [9, 10, 11]
Correlation: -0.41827794958057524
Covariance: 
[[ 1.29841024 -0.39901224]
 [-0.39901224  0.70085887]]
r^2:-1.1686624233096858
################
Months: [9, 10]
Correlation: -0.11216236454338616
Covariance: 
[[ 1.29841024 -0.11104651]
 [-0.11104651  0.75492463]]
r^2:-0.7591822258528571
################
Months: [10, 11]
Correlation: -0.13004611296040422
Covariance: 
[[ 1.29841024 -0.11165282]
 [-0.11165282  0.5677181 ]]
r^2:-0.6455817660426573</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Winter%20Temperature%20Prediction_files/figure-html/cell-24-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>As you would expect, using the data from November produces a better correlation with the Winter Mean Temperature than the October data (although not the case for September (!)). Interestingly, adding more months does not seem to improve the prediction. This could be due to the changable nature of the weather, meaning that it’s difficult to find 3 consecutive months that are similar to 3 other consecutive months!</p>
<p>Overall, it doesn’t seem that this is a very good way to predict this years Winter Mean temperature, as it seems to be predicting the something very close to the mean Winter Temperature. This is true no matter how many similar years you choose.</p>
<hr>
</section>
</section>
<section id="method-2-machine-learning" class="level1">
<h1>Method 2: Machine learning</h1>
<p>Let’s see if we can use ML to perform a better prediction. First, we need to split the data up into training and test sets.</p>
<div class="cell" data-execution_count="140">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#### ML training with single month</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dataframe_to_training_and_test_sets(df, pct_split, months_used_for_prediction, label_col):</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    autumn <span class="op">=</span> [x <span class="kw">in</span> months_used_for_prediction <span class="cf">for</span> x <span class="kw">in</span> df.index.month]</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    df_filtered <span class="op">=</span> df[autumn]</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    df_train <span class="op">=</span> df_filtered.loc[df_filtered.index[:<span class="bu">int</span>(<span class="bu">len</span>(df_filtered.index)<span class="op">*</span>pct_split)],:]</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    df_test <span class="op">=</span> df_filtered.loc[df_filtered.index[<span class="bu">int</span>(<span class="bu">len</span>(df_filtered.index)<span class="op">*</span>pct_split):],:]</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> df_train[label_col].<span class="bu">round</span>(<span class="dv">3</span>).values</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> df_train.drop(columns <span class="op">=</span> [label_col]).values</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>    y_test <span class="op">=</span> df_test[label_col].<span class="bu">round</span>(<span class="dv">3</span>).values</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>    X_test <span class="op">=</span> df_test.drop(columns <span class="op">=</span> [label_col]).values</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> X_train,y_train, X_test, y_test, df_train, df_test</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>label_col <span class="op">=</span> <span class="st">'Winter Mean Temperature'</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>all_months_with_winter_means[<span class="st">'Month'</span>] <span class="op">=</span> all_months_with_winter_means.index.month</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>all_months_with_winter_means_shuffled <span class="op">=</span> all_months_with_winter_means.sample(frac<span class="op">=</span><span class="dv">1</span>, random_state<span class="op">=</span><span class="dv">123</span>) <span class="co"># going to shuffle the data so that we have some of the more recent, warmer years in the training set</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>X_train, y_train, X_test, y_test, df_train, df_test <span class="op">=</span> dataframe_to_training_and_test_sets(all_months_with_winter_means_shuffled, <span class="fl">0.8</span>, [<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>], label_col)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we need to find a suitable regression model to perform our predictions:</p>
<div class="cell" data-execution_count="141">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.svm <span class="im">import</span> SVR</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> xgboost.sklearn <span class="im">import</span> XGBRegressor</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.gaussian_process <span class="im">import</span> GaussianProcessRegressor</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> VotingRegressor</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> GradientBoostingRegressor</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> model_selection</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_selection <span class="im">import</span> RFE</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_val_score</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> KFold, RepeatedKFold</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.utils <span class="im">import</span> class_weight</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> r2_score</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> run_exps(X_train: pd.DataFrame , y_train: pd.DataFrame, X_test: pd.DataFrame, y_test: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a><span class="co">    Lightweight script to test many models and find winners</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a><span class="co">    :param X_train: training split</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a><span class="co">    :param y_train: training target vector</span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a><span class="co">    :param X_test: test split</span></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a><span class="co">    :param y_test: test target vector</span></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a><span class="co">    :return: DataFrame of predictions</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>    dfs <span class="op">=</span> []</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>    models <span class="op">=</span> [</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>              (<span class="st">'LR'</span>, LinearRegression()), </span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>              (<span class="st">'SVR'</span>, SVR()),</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>              (<span class="st">'RFR'</span>, RandomForestRegressor()),</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>              (<span class="st">'GBR'</span>, GradientBoostingRegressor()),</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>                (<span class="st">'XGR'</span>, XGBRegressor()),</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> []</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>    names <span class="op">=</span> []</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>    scoring <span class="op">=</span> [<span class="st">'r2'</span>]</span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> name, model <span class="kw">in</span> models:</span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>            kfold <span class="op">=</span> model_selection.KFold(n_splits<span class="op">=</span><span class="dv">10</span>, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">123</span>)</span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>            cv_results <span class="op">=</span> model_selection.cross_validate(model, X_train, y_train, cv<span class="op">=</span>kfold, scoring<span class="op">=</span>scoring)</span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>            clf <span class="op">=</span> model.fit(X_train, y_train)</span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a>            y_pred <span class="op">=</span> clf.predict(X_test)</span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(name)</span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"R^2: "</span>,r2_score(y_test, y_pred))</span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a>            results.append(cv_results)</span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a>            names.append(name)</span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> </span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a>run_exps(X_train, y_train, X_test, y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>LR
R^2:  0.1603952612925963
SVR
R^2:  -0.007026424218675276
RFR
R^2:  0.39754923181773816
GBR
R^2:  0.4308514206317199
XGR
R^2:  0.319008600725606</code></pre>
</div>
</div>
<p>It looks like Linear Regression is the model with the best r^2</p>
<div class="cell" data-execution_count="212">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> naive_confidence_intervals(model, X, y, alpha):</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    residuals <span class="op">=</span> y <span class="op">-</span> model.predict(X)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">#plt.hist(residuals) # histogram indicates the errors are not normally distributed, therefore need to use the jackknife method</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    ci <span class="op">=</span> np.quantile(residuals, <span class="dv">1</span> <span class="op">-</span> alpha)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ci</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> jackknife_confidence_intervals(model, X_train, y_train, X_test, y_test, alpha):</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    kf <span class="op">=</span> KFold(n_splits<span class="op">=</span><span class="bu">len</span>(y_train)<span class="op">-</span><span class="dv">1</span>, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">123</span>)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> []</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> train_index, test_index <span class="kw">in</span> kf.split(X_train):</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>        X_train_, X_test_ <span class="op">=</span> X_train[train_index], X_train[test_index]</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>        y_train_, y_test_ <span class="op">=</span> y_train[train_index], y_train[test_index]</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>        model.fit(X_train_, y_train_)</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>        res.extend(<span class="bu">list</span>(y_test_ <span class="op">-</span> model.predict(X_test_)))</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>    ci <span class="op">=</span> np.quantile(res, <span class="dv">1</span> <span class="op">-</span> alpha)</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ci</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_and_evaluate(model_type, X_train, y_train, X_test, y_test):</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_type</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>    model.fit(X_train,y_train)</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># define model evaluation method</span></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>    cv <span class="op">=</span> RepeatedKFold(n_splits<span class="op">=</span><span class="dv">10</span>, n_repeats<span class="op">=</span><span class="dv">3</span>, random_state<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>    scores <span class="op">=</span> cross_val_score(model, X_train,y_train, scoring<span class="op">=</span><span class="st">'neg_mean_absolute_error'</span>, cv<span class="op">=</span>cv, n_jobs<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>    scores <span class="op">=</span> np.<span class="bu">abs</span>(scores)</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Mean MAE: </span><span class="sc">%.5f</span><span class="st"> (</span><span class="sc">%.8f</span><span class="st">)'</span> <span class="op">%</span> (scores.mean(), scores.std()) )</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>    mae <span class="op">=</span> mean_absolute_error(y_test, model.predict(X_test))</span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>    mape <span class="op">=</span> mean_absolute_percentage_error(y_test, model.predict(X_test))</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>    ci <span class="op">=</span> jackknife_confidence_intervals(model, X_train, y_train, X_test, y_test, <span class="fl">0.2</span>) <span class="co"># CI at the 80th percentile</span></span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>    <span class="co">#ci = naive_confidence_intervals(model,X_test, y_test, 0.05)</span></span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>    r2 <span class="op">=</span> r2_score(y_test, model.predict(X_test))</span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"r^2 (test set): "</span>, r2)</span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"MAE (test set): "</span>,mae)</span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model, ci</span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> scatter_plot_of_results(y_test, predicted_vals, interval):</span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a>    plt.scatter(y_test, predicted_vals, label<span class="op">=</span><span class="st">'Predictions'</span>)</span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a>    plt.errorbar(y_test, predicted_vals, yerr<span class="op">=</span>interval, fmt<span class="op">=</span><span class="st">'o'</span>, label <span class="op">=</span> <span class="st">"CI at 80th pctile"</span>)</span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a>    plt.plot(y_test, y_test, label<span class="op">=</span><span class="st">'Perfect prediction line'</span>, c<span class="op">=</span><span class="st">'r'</span>)</span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Actual ($^\circ$C)'</span>)</span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Predicted ($^\circ$C)'</span>)</span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'Actual vs predicted'</span>)</span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true" tabindex="-1"></a>    plt.legend()</span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span></span>
<span id="cb33-52"><a href="#cb33-52" aria-hidden="true" tabindex="-1"></a>    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-scrolled="true" data-execution_count="213">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>model, interval <span class="op">=</span> train_and_evaluate(RandomForestRegressor(), X_train, y_train, X_test, y_test)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>scatter_plot_of_results(y_test, model.predict(X_test), interval)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mean MAE: 1.17752 (0.31619627)
r^2 (test set):  0.6595337373342609
MAE (test set):  1.1167307692307697</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Winter%20Temperature%20Prediction_files/figure-html/cell-28-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="145">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_forecast(percentile):</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    forecasts <span class="op">=</span> {<span class="dv">0</span>: <span class="st">'Very Cold'</span>, <span class="dv">20</span>: <span class="st">'Colder than average'</span>, <span class="dv">40</span>: <span class="st">'Around Average'</span>, <span class="dv">60</span>: <span class="st">'Milder than average'</span>, <span class="dv">80</span>: <span class="st">'Very Mild'</span>,<span class="dv">100</span>: <span class="st">""</span>}</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    keys <span class="op">=</span> <span class="bu">list</span>(forecasts.keys())</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    predicted_forecast <span class="op">=</span> forecasts[[keys[k] <span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(keys)) <span class="cf">if</span> percentile <span class="op">&gt;</span> keys[k] <span class="kw">and</span>  percentile <span class="op">&lt;</span> keys[k<span class="op">+</span><span class="dv">1</span>]][<span class="dv">0</span>]]</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> predicted_forecast</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> winter_prediction(percentile, date):</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Prediction: this winter (as predicted with the latest data from </span><span class="sc">{date}</span><span class="st"> </span><span class="ch">\n</span><span class="st">will be in the </span><span class="sc">{p}</span><span class="st">th percentile of all UK winters from the dataset</span><span class="ch">\n</span><span class="st">"</span>.<span class="bu">format</span>(date <span class="op">=</span> predicted_from_date, p <span class="op">=</span> <span class="bu">round</span>(percentile,<span class="dv">2</span>)))</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>features_df[<span class="st">'Month'</span>] <span class="op">=</span> features_df.index.month</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>predicted_from_date <span class="op">=</span> features_df.index[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>predict_this_winter <span class="op">=</span> model.predict(np.array(features_df.loc[predicted_from_date].values).reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>]</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>predict_this_winter</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="145">
<pre><code>4.83075</code></pre>
</div>
</div>
<div class="cell" data-execution_count="146">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>percentile <span class="op">=</span> stats.percentileofscore(all_winter_means.values, predict_this_winter)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>winter_prediction(percentile, predicted_from_date)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>get_forecast(percentile)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Prediction: this winter (as predicted with the latest data from 2022-09-01 00:00:00 
will be in the 56.82th percentile of all UK winters from the dataset
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="146">
<pre><code>'Around Average'</code></pre>
</div>
</div>
<p>Overall, this method does much better than the analogue method we used before, although it could be improved. Can we do better than this?</p>
<hr>
</section>
<section id="method-3-ml-with-a-lookback" class="level1">
<h1>Method 3: ML with a lookback</h1>
<p>This method is similar to method 2, however, we are going to add a lookback to the features, i.e.&nbsp;not only taking into account the current months data as a feature, but also previous months.</p>
<div class="cell" data-execution_count="147">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">#### ML training with many months</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dataframe_with_lookback(data, n_in<span class="op">=</span><span class="dv">1</span>, n_out<span class="op">=</span><span class="dv">1</span>, dropnan<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Frame a time series as a supervised learning dataset.</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Arguments:</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="co">        data: Sequence of observations as a list or NumPy array.</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="co">        n_in: Number of lag observations as input (X).</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="co">        n_out: Number of observations as output (y).</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="co">        dropnan: Boolean whether or not to drop rows with NaN values.</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="co">        Pandas DataFrame of series framed for supervised learning.</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>    n_vars <span class="op">=</span> <span class="dv">1</span> <span class="cf">if</span> <span class="bu">type</span>(data) <span class="kw">is</span> <span class="bu">list</span> <span class="cf">else</span> data.shape[<span class="dv">1</span>]</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame(data)</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>    cols, names <span class="op">=</span> <span class="bu">list</span>(), <span class="bu">list</span>()</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># input sequence (t-n, ... t-1)</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n_in, <span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>        cols.append(df.shift(i))</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>        names <span class="op">+=</span> [(df.columns[j]<span class="op">+</span><span class="st">'(t-</span><span class="sc">%d</span><span class="st">)'</span> <span class="op">%</span> (i)) <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(n_vars)]</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># forecast sequence (t, t+1, ... t+n)</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, n_out):</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>        cols.append(df.shift(<span class="op">-</span>i))</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>            names <span class="op">+=</span> [(df.columns[j]) <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(n_vars)]</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>            names <span class="op">+=</span> [(df.columns[j]<span class="op">+</span><span class="st">'(t+</span><span class="sc">%d</span><span class="st">)'</span> <span class="op">%</span> (i)) <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(n_vars)]</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># put it all together</span></span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>    agg <span class="op">=</span> pd.concat(cols, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>    agg.columns <span class="op">=</span> names</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># drop rows with NaN values</span></span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> dropnan:</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>        agg.dropna(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> agg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To give the model the best chance of making a good prediction, let’s use the data for November (as the latest data), and lookback 2 months.</p>
<div class="cell" data-execution_count="148">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>df_shifted <span class="op">=</span> dataframe_with_lookback(all_months_with_winter_means, n_in<span class="op">=</span><span class="dv">2</span>, n_out<span class="op">=</span><span class="dv">1</span>, dropnan<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>df_shifted[<span class="st">'Month'</span>] <span class="op">=</span> df_shifted.index.month</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>df_shifted <span class="op">=</span> df_shifted.drop(columns <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> df_shifted.columns <span class="cf">if</span> label_col <span class="kw">in</span> col <span class="kw">and</span> col <span class="op">!=</span> label_col])</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>df_shifted <span class="op">=</span> df_shifted.sample(frac<span class="op">=</span><span class="fl">1.0</span>, random_state<span class="op">=</span><span class="dv">123</span>)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>X_train, y_train, X_test, y_test, df_train, df_test <span class="op">=</span> dataframe_to_training_and_test_sets(df_shifted, <span class="fl">0.8</span>, [<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>], label_col)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="149">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>run_exps(X_train, y_train, X_test, y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>LR
R^2:  -0.10098019977034256
SVR
R^2:  -0.21862449182580934
RFR
R^2:  0.1740263054356963
GBR
R^2:  0.35616737999262116
XGR
R^2:  0.1584880354841618</code></pre>
</div>
</div>
<p>XGBRegressor seems to be the best performer, albeit pretty poor performance</p>
<div class="cell" data-scrolled="true" data-execution_count="150">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>model, interval <span class="op">=</span> train_and_evaluate(XGBRegressor(), X_train, y_train, X_test, y_test)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>scatter_plot_of_results(y_test, model.predict(X_test), interval)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mean MAE: 0.90292 (0.13446777)
r^2 (test set):  0.18066621573589392
MAE (test set):  0.8392910396869365</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Winter%20Temperature%20Prediction_files/figure-html/cell-34-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="151">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>predicted_from_date <span class="op">=</span> df_shifted.index[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> df_shifted.drop(columns<span class="op">=</span>[<span class="st">'Winter Mean Temperature'</span>]).loc[predicted_from_date]</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>predict_this_winter <span class="op">=</span> model.predict(features.values.reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>]</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>percentile <span class="op">=</span> stats.percentileofscore(all_winter_means.values, predict_this_winter)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>winter_prediction(percentile, predicted_from_date)</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>get_forecast(percentile)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Prediction: this winter (as predicted with the latest data from 2021-09-01 00:00:00 
will be in the 36.36th percentile of all UK winters from the dataset
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="151">
<pre><code>'Colder than average'</code></pre>
</div>
</div>
<p>Hmm, the model does not seemed to have improved with more features. Perhaps there are some redundant features, let’s rank the features:</p>
<div class="cell" data-scrolled="true" data-execution_count="152">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co">######## Feature Importance Section</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co"># define the method</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>rfe <span class="op">=</span> RFE(estimator<span class="op">=</span>XGBRegressor(), n_features_to_select<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>rfe.fit(X_train,y_train)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>df_feature_selection <span class="op">=</span> pd.DataFrame([], columns <span class="op">=</span> [<span class="st">'Feature Name'</span>, <span class="st">'Ranking'</span>])</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(X_train.shape[<span class="dv">1</span>]):</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print('Column: %d, Name: %s,  Selected %s, Rank: %.3f' % (i,df_train.drop(columns=['Winter Mean Temperature']).columns[i],  rfe.support_[i], rfe.ranking_[i]))</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>    df_feature_selection <span class="op">=</span> df_feature_selection.append({<span class="st">'Feature Name'</span>: df_train.drop(columns<span class="op">=</span>[<span class="st">'Winter Mean Temperature'</span>]).columns[i], <span class="st">'Ranking'</span>: rfe.ranking_[i]}, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>df_feature_selection.sort_values(<span class="st">'Ranking'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="152">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Feature Name</th>
      <th>Ranking</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>36</th>
      <td>UK_rainfall</td>
      <td>1</td>
    </tr>
    <tr>
      <th>32</th>
      <td>AMO</td>
      <td>1</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Sunspots(t-1)</td>
      <td>1</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Nino3.4(t-1)</td>
      <td>1</td>
    </tr>
    <tr>
      <th>14</th>
      <td>SOI(t-1)</td>
      <td>1</td>
    </tr>
    <tr>
      <th>35</th>
      <td>PNA</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Sunspots(t-2)</td>
      <td>3</td>
    </tr>
    <tr>
      <th>16</th>
      <td>PDO(t-1)</td>
      <td>4</td>
    </tr>
    <tr>
      <th>7</th>
      <td>AO(t-2)</td>
      <td>5</td>
    </tr>
    <tr>
      <th>30</th>
      <td>Sunspots</td>
      <td>6</td>
    </tr>
    <tr>
      <th>6</th>
      <td>AMO(t-2)</td>
      <td>7</td>
    </tr>
    <tr>
      <th>3</th>
      <td>PDO(t-2)</td>
      <td>8</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Nino3.4(t-2)</td>
      <td>9</td>
    </tr>
    <tr>
      <th>27</th>
      <td>SOI</td>
      <td>10</td>
    </tr>
    <tr>
      <th>26</th>
      <td>Eurasian_Snow_Cover</td>
      <td>11</td>
    </tr>
    <tr>
      <th>33</th>
      <td>AO</td>
      <td>12</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Eurasian_Snow_Cover(t-1)</td>
      <td>13</td>
    </tr>
    <tr>
      <th>10</th>
      <td>UK_rainfall(t-2)</td>
      <td>14</td>
    </tr>
    <tr>
      <th>9</th>
      <td>PNA(t-2)</td>
      <td>15</td>
    </tr>
    <tr>
      <th>8</th>
      <td>NAO(t-2)</td>
      <td>16</td>
    </tr>
    <tr>
      <th>28</th>
      <td>Nino3.4</td>
      <td>17</td>
    </tr>
    <tr>
      <th>19</th>
      <td>AMO(t-1)</td>
      <td>18</td>
    </tr>
    <tr>
      <th>22</th>
      <td>PNA(t-1)</td>
      <td>19</td>
    </tr>
    <tr>
      <th>11</th>
      <td>UK_mean_temp(t-2)</td>
      <td>20</td>
    </tr>
    <tr>
      <th>23</th>
      <td>UK_rainfall(t-1)</td>
      <td>21</td>
    </tr>
    <tr>
      <th>31</th>
      <td>QBO</td>
      <td>22</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Eurasian_Snow_Cover(t-2)</td>
      <td>23</td>
    </tr>
    <tr>
      <th>20</th>
      <td>AO(t-1)</td>
      <td>24</td>
    </tr>
    <tr>
      <th>29</th>
      <td>PDO</td>
      <td>25</td>
    </tr>
    <tr>
      <th>1</th>
      <td>SOI(t-2)</td>
      <td>26</td>
    </tr>
    <tr>
      <th>5</th>
      <td>QBO(t-2)</td>
      <td>27</td>
    </tr>
    <tr>
      <th>18</th>
      <td>QBO(t-1)</td>
      <td>28</td>
    </tr>
    <tr>
      <th>34</th>
      <td>NAO</td>
      <td>29</td>
    </tr>
    <tr>
      <th>21</th>
      <td>NAO(t-1)</td>
      <td>30</td>
    </tr>
    <tr>
      <th>37</th>
      <td>UK_mean_temp</td>
      <td>31</td>
    </tr>
    <tr>
      <th>24</th>
      <td>UK_mean_temp(t-1)</td>
      <td>32</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Month(t-2)</td>
      <td>33</td>
    </tr>
    <tr>
      <th>25</th>
      <td>Month(t-1)</td>
      <td>34</td>
    </tr>
    <tr>
      <th>38</th>
      <td>Month</td>
      <td>35</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="153">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co">#df_shifted = df_shifted[['UK_rainfall','NAO', 'QBO', 'AO(t-1)', 'AMO','Month', 'Winter Mean Temperature']]</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>df_shifted <span class="op">=</span> df_shifted[[<span class="st">'UK_rainfall'</span>,<span class="st">'Nino3.4(t-1)'</span>, <span class="st">'Sunspots(t-1)'</span>, <span class="st">'SOI(t-1)'</span>, <span class="st">'AMO'</span>,<span class="st">'Month'</span>, <span class="st">'Winter Mean Temperature'</span>]]</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>X_train, y_train, X_test, y_test, df_train, df_test <span class="op">=</span> dataframe_to_training_and_test_sets(df_shifted, <span class="fl">0.8</span>, [<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>], <span class="st">'Winter Mean Temperature'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="154">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>model, interval <span class="op">=</span> train_and_evaluate(XGBRegressor(), X_train, y_train, X_test, y_test)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>scatter_plot_of_results(y_test, model.predict(X_test), interval)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mean MAE: 0.70440 (0.17346970)
r^2 (test set):  -0.23807772090063328
MAE (test set):  1.1042655073312613</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Winter%20Temperature%20Prediction_files/figure-html/cell-38-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>It doesn’t seem like filtering the features produces any gains. Lesson learned, more features does not alway equal a better model. Intuitively this makes sense, what matters most when trying to predict weather/climate is the most recent observations, not something that occurs 2 months ago.</p>
<hr>
</section>
<section id="method-4-using-ml-to-predict-next-months-mean-temperature" class="level1">
<h1>Method 4: Using ML to predict next months mean temperature</h1>
<div class="cell" data-execution_count="180">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>df_shifted <span class="op">=</span> dataframe_with_lookback(all_months_with_winter_means.drop(columns<span class="op">=</span><span class="st">'Winter Mean Temperature'</span>), n_in<span class="op">=</span><span class="dv">2</span>, n_out<span class="op">=</span><span class="dv">1</span>, dropnan<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>df_shifted[<span class="st">'Month'</span>] <span class="op">=</span> df_shifted.index.month</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="202">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>n_months_ahead <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>df_shifted[<span class="st">'UK_mean_temp (t+1)'</span>] <span class="op">=</span> df_shifted[<span class="st">'UK_mean_temp'</span>]</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>df_shifted[<span class="st">'UK_mean_temp (t+1)'</span>] <span class="op">=</span> df_shifted.shift(<span class="op">-</span>n_months_ahead)[<span class="st">'UK_mean_temp (t+1)'</span>]</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>df_shifted <span class="op">=</span> df_shifted.dropna(axis<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="203">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>X_train, y_train, X_test, y_test, df_train, df_test <span class="op">=</span> dataframe_to_training_and_test_sets(df_shifted, <span class="fl">0.8</span>, [<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>], <span class="st">'UK_mean_temp (t+1)'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="204">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>run_exps(X_train, y_train, X_test, y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>LR
R^2:  0.4640143981370094
SVR
R^2:  0.03044869387272242
RFR
R^2:  0.6697714309544459
GBR
R^2:  0.6785911103425025
XGR
R^2:  0.6448591987840867</code></pre>
</div>
</div>
<div class="cell" data-execution_count="205">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>model, interval <span class="op">=</span> train_and_evaluate(XGBRegressor(), X_train, y_train, X_test, y_test)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>scatter_plot_of_results(y_test, model.predict(X_test), interval)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mean MAE: 1.27559 (0.34232159)
r^2 (test set):  0.6194547144969771
MAE (test set):  1.198695004903353</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Winter%20Temperature%20Prediction_files/figure-html/cell-43-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="206">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>df_shifted2 <span class="op">=</span> dataframe_with_lookback(features_df, n_in<span class="op">=</span><span class="dv">2</span>, n_out<span class="op">=</span><span class="dv">1</span>, dropnan<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>df_shifted2[<span class="st">'Month'</span>] <span class="op">=</span> df_shifted2.index.month</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="207">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>predict_using_month <span class="op">=</span> df_shifted2.index[<span class="op">-</span><span class="dv">1</span>] <span class="co"># get last row of dataset (should be the latest data)</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>predict_next_month <span class="op">=</span> model.predict(df_shifted2[df_shifted2.index <span class="op">==</span> predict_using_month].values.reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="209">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> timedelta</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(predict_next_month, <span class="st">"+/-"</span>, interval)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>mean_UK_temps_for_predicted_month <span class="op">=</span> df_shifted2[df_shifted2.index.month <span class="op">==</span>predict_month.month<span class="op">+</span>n_months_ahead][<span class="st">'UK_mean_temp'</span>]</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>mean_UK_temps_for_predicted_month.hist()</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>plt.axvline(predict_next_month, c<span class="op">=</span><span class="st">'r'</span>)</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>plt.axvline(predict_next_month<span class="op">+</span>interval, c<span class="op">=</span><span class="st">'yellow'</span>)</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>plt.axvline(predict_next_month<span class="op">-</span>interval, c<span class="op">=</span><span class="st">'yellow'</span>)</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>percentile <span class="op">=</span> stats.percentileofscore(mean_UK_temps_for_predicted_month, predict_next_month)</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Predicted forecast for month of </span><span class="sc">{date}</span><span class="st"> </span><span class="ch">\n</span><span class="sc">{fc}</span><span class="st">"</span>.<span class="bu">format</span>(date <span class="op">=</span> <span class="bu">str</span>((predict_using_month<span class="op">+</span>timedelta(days<span class="op">=</span><span class="dv">31</span><span class="op">*</span>n_months_ahead)).date())[:<span class="op">-</span><span class="dv">3</span>], fc<span class="op">=</span> get_forecast(percentile)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>10.371333 +/- 1.174963150024414
Predicted forecast for month of 2022-10 
Around Average</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Winter%20Temperature%20Prediction_files/figure-html/cell-46-output-2.png" class="img-fluid"></p>
</div>
</div>
<hr>
<p>Unsurprisingly, predicting the weather is difficult! Although, we can still draw some conclusions from this analysis. 1. Using climate index analogues is not a good way of predicting 2. Adding data from n months ago does not improve model performance 3. It’s much easier to predict next months mean temperature than the average of the next 3 months 4. It’s very difficult to say with any confidence what the UK winter of 2022/2023 is going to be like, we’ll have to wait and see</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>